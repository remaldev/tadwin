<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Primary Meta Tags -->
  <title>{{title}}</title>
  <meta name="title" content="{{title}}" />
  <meta name="description" content="{{description}}" />
  <meta name="author" content="{{author}}" />
  {{keywords}}
  {{canonical}}

  <!-- Favicons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
  <link rel="icon" href="/favicon.ico" sizes="48x48" />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="{{appleTouchIcon}}" />
  <link rel="manifest" href="{{webManifest}}" />

  <!-- Open Graph / Facebook / LinkedIn -->
  <meta property="og:type" content="{{ogType}}" />
  <meta property="og:url" content="{{url}}" />
  <meta property="og:title" content="{{title}}" />
  <meta property="og:description" content="{{description}}" />
  {{ogLocale}}
  {{ogImage}}
  {{ogImageWidth}}
  {{ogImageHeight}}
  <meta property="og:site_name" content="{{siteName}}" />
  {{publishDate}}
  {{modifiedDate}}
  {{articleAuthor}}
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="{{url}}" />
  <meta name="twitter:title" content="{{title}}" />
  <meta name="twitter:description" content="{{description}}" />
  {{twitterImage}}
  {{twitterCreator}}
  <!-- Structured Data -->
  {{structuredData}}

  <!-- CSS Variables -->
  {{cssVars}}

  <link rel="stylesheet" href="/style.css?v={{cssHash}}" />
</head>

<body>
  <main>
    {{content}}
  </main>
  <footer class="site-footer">
    <p>&copy; {{year}} &middot; Powered by <a href="https://github.com/remaldev/tadwin" target="_blank"
        rel="noopener">تدوين</a></p>
  </footer>
  <button id="back-to-top" class="back-to-top" aria-label="Back to top">↑</button>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const toc = document.querySelector('.toc');
      if (toc) {
        const heading = toc.querySelector('h2');
        if (heading) {
          heading.addEventListener('click', function () {
            toc.classList.toggle('collapsed');
          });
        }

        // Scroll tracking for TOC
        const tocLinks = toc.querySelectorAll('a');
        const headings = document.querySelectorAll('.article-content h2[id], .article-content h3[id]');
        
        if (tocLinks.length > 0 && headings.length > 0) {
          const observerOptions = {
            rootMargin: '-80px 0px -80% 0px',
            threshold: 0
          };

          const observer = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
              if (entry.isIntersecting) {
                const id = entry.target.getAttribute('id');
                tocLinks.forEach(function(link) {
                  link.classList.remove('active');
                });
                const activeLink = toc.querySelector('a[href="#' + id + '"]');
                if (activeLink) {
                  activeLink.classList.add('active');
                }
              }
            });
          }, observerOptions);

          headings.forEach(function(heading) {
            observer.observe(heading);
          });
        }
      }

      const backToTopBtn = document.getElementById('back-to-top');
      window.addEventListener('scroll', function () {
        if (window.pageYOffset > 300) {
          backToTopBtn.classList.add('visible');
        } else {
          backToTopBtn.classList.remove('visible');
        }
      });

      backToTopBtn.addEventListener('click', function () {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      // Share button - copy link functionality
      const copyLinkBtn = document.querySelector('.copy-link');
      if (copyLinkBtn) {
        copyLinkBtn.addEventListener('click', function () {
          const url = this.getAttribute('data-url');
          navigator.clipboard.writeText(url).then(function () {
            copyLinkBtn.classList.add('copied');
            const originalText = copyLinkBtn.innerHTML;
            copyLinkBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>Copied!';
            setTimeout(function () {
              copyLinkBtn.classList.remove('copied');
              copyLinkBtn.innerHTML = originalText;
            }, 2000);
          });
        });
      }
    });
  </script>
</body>

</html>
